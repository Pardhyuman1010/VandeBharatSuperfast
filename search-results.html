<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="canonical" href="https://vandebharatsuperfast.com/search-results.html">
  <title>Train Search Results</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Train Search Results</h1>

    <div class="flex gap-4 mb-4">
      <input list="stationList" id="fromStation" class="border px-3 py-2 rounded w-1/2" placeholder="From Station" />
      <input list="stationList" id="toStation" class="border px-3 py-2 rounded w-1/2" placeholder="To Station" />
    </div>

    <datalist id="stationList"></datalist>

    <table class="table-auto w-full border bg-white shadow-md" id="resultsTable">
      <thead class="bg-gray-200">
        <tr>
          <th class="px-4 py-2">Train Number</th>
          <th class="px-4 py-2">Train Name</th>
          <th class="px-4 py-2">Departure Station</th>
          <th class="px-4 py-2">Arrival Station</th>
          <th class="px-4 py-2">Departure Time</th>
          <th class="px-4 py-2">Arrival Time</th>
          <th class="px-4 py-2">Journey Duration</th>
        </tr>
      </thead>
      <tbody class="text-center"></tbody>
    </table>
  </div>

  <!-- Station Details Modal -->
  <div id="stationDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg p-6 w-11/12 md:w-5/6 max-h-[80vh] overflow-auto">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold">Train Route Details</h3>
        <button onclick="document.getElementById('stationDetailModal').classList.add('hidden')" class="text-red-600 text-xl">&times;</button>
      </div>
      <div id="stationDetailModalContent"></div>
    </div>
  </div>

  <script>
    let trainData = [];

    fetch("trains.json")
      .then(res => res.json())
      .then(data => {
        trainData = data;

        const stationSet = new Set();
        data.forEach(train => {
          stationSet.add(train["Departure Station"]);
          stationSet.add(train["Arrival Station"]);
        });

        const datalist = document.getElementById("stationList");
        stationSet.forEach(station => {
          const option = document.createElement("option");
          option.value = station;
          datalist.appendChild(option);
        });

        const from = localStorage.getItem("fromStation") || "";
        const to = localStorage.getItem("toStation") || "";
        document.getElementById("fromStation").value = from;
        document.getElementById("toStation").value = to;

        searchTrains();
      });

    function searchTrains() {
      const from = document.getElementById("fromStation").value.trim().toLowerCase();
      const to = document.getElementById("toStation").value.trim().toLowerCase();
      const tbody = document.querySelector("#resultsTable tbody");
      tbody.innerHTML = "";

      const filtered = trainData.filter(train => {
        const matchFrom = from ? train["Departure Station"].toLowerCase().includes(from) : true;
        const matchTo = to ? train["Arrival Station"].toLowerCase().includes(to) : true;
        return matchFrom && matchTo;
      });

      if (filtered.length === 0) {
        tbody.innerHTML = `<tr><td colspan="7" class="text-center text-red-600 py-4">No matching trains found.</td></tr>`;
        return;
      }

      filtered.forEach(train => {
        const trainNum = train["Train Number"];
        tbody.innerHTML += `
          <tr class="text-center border-b">
            <td class="px-4 py-2 text-blue-600 underline cursor-pointer" onclick="showTrainDetails('${trainNum}')">${trainNum}</td>
            <td class="px-4 py-2">${train["Train Name"]}</td>
            <td class="px-4 py-2">${train["Departure Station"]}</td>
            <td class="px-4 py-2">${train["Arrival Station"]}</td>
            <td class="px-4 py-2">${train["Departure Time"]}</td>
            <td class="px-4 py-2">${train["Arrival Time"]}</td>
            <td class="px-4 py-2">${train["Journey Duration"]}</td>
          </tr>
        `;
      });
    }

    function showTrainDetails(trainNumber) {
  console.log("Clicked Train Number:", trainNumber); // Debug log

  fetch("train_station_list.json")
    .then(res => res.json())
    .then(data => {
      const stations = data.filter(station => station["Train Number"].toString().trim() === trainNumber.trim());

      if (stations.length === 0) {
        document.getElementById("stationDetailModalContent").innerHTML = "<p>No data found for this train.</p>";
        document.getElementById("stationDetailModal").classList.remove("hidden");
        return;
      }

      const columns = Object.keys(stations[0]);
      let content = `<h2 class="text-xl font-bold mb-4">Train ${trainNumber} - Station Details</h2>
        <div class="overflow-x-auto">
          <table class="w-full table-auto text-sm border-collapse border border-gray-300">
            <thead><tr>`;

      columns.forEach(col => {
        content += `<th class="border border-gray-300 bg-gray-100 px-4 py-2">${col}</th>`;
      });

      content += `</tr></thead><tbody>`;

      stations.forEach(station => {
        content += `<tr>`;
        columns.forEach(col => {
          content += `<td class="border border-gray-300 px-4 py-2">${station[col]}</td>`;
        });
        content += `</tr>`;
      });

      content += `</tbody></table></div>`;

      document.getElementById("stationDetailModalContent").innerHTML = content;
      document.getElementById("stationDetailModal").classList.remove("hidden");
    })
    .catch(error => {
      console.error("Error fetching station list:", error);
      alert("Failed to load train details.");
    });
}

  </script>
</body>
</html>
