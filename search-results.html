<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search Results - Vande Bharat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="bg-gray-100 font-sans">

  <!-- Search Section -->
  <section class="w-full px-4 py-10 bg-orange-600">
    <div class="flex flex-col md:flex-row gap-4 justify-center items-center">
      <input type="text" id="fromStation" list="stationList" placeholder="Departure Station"
        class="w-full md:w-1/4 px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm" />
      <input type="text" id="toStation" list="stationList" placeholder="Arrival Station"
        class="w-full md:w-1/4 px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 shadow-sm" />
      <datalist id="stationList"></datalist>
      <button onclick="searchTrains()"
        class="w-full md:w-auto px-6 py-3 bg-blue-800 hover:bg-blue-700 text-white font-medium rounded-lg shadow-md transition-all duration-300">
        <i class="fas fa-search mr-2"></i>Search
      </button>
    </div>
  </section>

  <!-- Results Table -->
  <section class="w-full px-4 py-10">
    <div class="overflow-x-auto bg-white rounded-lg shadow-md">
      <table id="resultsTable" class="min-w-full divide-y divide-gray-200 text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2">Train No</th>
            <th class="px-4 py-2">Name</th>
            <th class="px-4 py-2">From</th>
            <th class="px-4 py-2">To</th>
            <th class="px-4 py-2">Timing</th>
            <th class="px-4 py-2">Duration</th>
            <th class="px-4 py-2">Distance</th>
            <th class="px-4 py-2">Days</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200"></tbody>
      </table>
    </div>
  </section>

  <script>
    let trainData = [];

    // Load station list and train data
    fetch("trains.json")
      .then(res => res.json())
      .then(data => {
        trainData = data;

        // Fill station list
        const stations = new Set();
        data.forEach(train => {
          stations.add(train["Departure Station"]);
          stations.add(train["Arrival Station"]);
        });

        const datalist = document.getElementById("stationList");
        stations.forEach(station => {
          const option = document.createElement("option");
          option.value = station;
          datalist.appendChild(option);
        });

        // Pre-fill values and auto search
        const from = localStorage.getItem("fromStation") || "";
        const to = localStorage.getItem("toStation") || "";
        document.getElementById("fromStation").value = from;
        document.getElementById("toStation").value = to;

        if (from && to) {
          showResults(from, to);
        }
      });

    function searchTrains() {
  const from = document.getElementById("fromStation").value.trim();
  const to = document.getElementById("toStation").value.trim();

  if (!from && !to) {
    alert("Please enter at least one station.");
    return;
  }

  localStorage.setItem("fromStation", from);
  localStorage.setItem("toStation", to);
  showResults(from, to);
}

    function showResults(from, to) {
      const tbody = document.querySelector("#resultsTable tbody");
      tbody.innerHTML = "";

      const filtered = trainData.filter(train => {
    const fromMatch = from ? train["Departure Station"].toLowerCase().includes(from.toLowerCase()) : true;
  const toMatch = to ? train["Arrival Station"].toLowerCase().includes(to.toLowerCase()) : true;
  return fromMatch && toMatch;
});

      if (filtered.length === 0) {
        tbody.innerHTML = `<tr><td colspan="8" class="text-center py-4 text-red-500">No trains found for this route.</td></tr>`;
        return;
      }

      filtered.forEach(train => {
        const row = `
          <tr>
            <td class="px-4 py-2">${train["Train Number"]}</td>
            <td class="px-4 py-2">${train["Train Name"]}</td>
            <td class="px-4 py-2">${train["Departure Station"]} (${train["Departure Station Code"]})</td>
            <td class="px-4 py-2">${train["Arrival Station"]} (${train["Arrival Station Code"]})</td>
            <td class="px-4 py-2">${train["Departure Time"]} â†’ ${train["Arrival Time"]}</td>
            <td class="px-4 py-2">${train["Journey Duration"]}</td>
            <td class="px-4 py-2">${train["Journey Distance"]}</td>
            <td class="px-4 py-2">${train["Weekly Schedule"]}</td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }
  </script>

</body>
</html>
